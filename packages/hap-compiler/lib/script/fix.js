"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fix=formatBetter,exports.formatWhenFix=format;const esprima=require("esprima"),escodegen=require("escodegen"),LEFT_MODULE_EXPORTS_AST={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"module"},property:{type:"Identifier",name:"exports"}};function removeAllLoc(e){return function e(t){if(Array.isArray(t))t.forEach(e);else if("object"==typeof t)for(const r in t)"loc"===r&&delete t[r],"range"===r?delete t[r]:"object"==typeof t[r]&&e(t[r])}(e=JSON.parse(JSON.stringify(e))),e}function findDataValue(e){let t,r,n,o;return e&&e.body&&e.body.length&&e.body.forEach(function(e){"ExpressionStatement"===e.type&&"AssignmentExpression"===(t=e.expression).type&&"="===t.operator&&(r=removeAllLoc(t.left||{}),JSON.stringify(r)===JSON.stringify(LEFT_MODULE_EXPORTS_AST)&&"ObjectExpression"===(n=t.right).type&&n.properties.some(function(e){if("Property"===e.type&&e.key&&"data"===e.key.name&&e.value&&"ObjectExpression"===e.value.type)return o=e,!0}))}),o}function convertValueAst(e){return{type:"FunctionExpression",id:null,params:[],defaults:[],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:e}]},generator:!1,expression:!1}}function format(e,t){const r=esprima.parse(e),n=findDataValue(r);return n&&(n.value=convertValueAst(n.value),t=!0),t?escodegen.generate(r):e}function formatBetter(e){const t=findDataValue(esprima.parseScript(e,{range:!0}));if(t){const r=t.value.range[0],n=t.value.range[1],o=n-r;return e.substr(0,r)+"function () {return "+e.substr(r,o)+"}"+e.substr(n)}return e}
//# sourceMappingURL=fix.js.map
